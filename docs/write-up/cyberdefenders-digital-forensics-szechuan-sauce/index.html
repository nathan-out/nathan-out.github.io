

<!DOCTYPE html>
<html
  lang="fr-fr"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="false"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="fr-fr" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Cyberdefenders · Digital Forensic · Szechuan Sauce &middot; nathan.out</title>
    <meta name="title" content="Cyberdefenders · Digital Forensic · Szechuan Sauce &middot; nathan.out" />
  
  
  
  
  
  <link rel="canonical" href="https://nathan-out.github.io/write-up/cyberdefenders-digital-forensics-szechuan-sauce/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.61af27f7db2873a26e050d3d8322b57af2ffeb87e36ba1318d1238ed6c92220fb1d2ea5408d76c8692792dab37bd0d83cd00b914603e059e185b8b794ff3531c.css"
    integrity="sha512-Ya8n99soc6JuBQ09gyK1evL/64fja6ExjRI47WySIg&#43;x0upUCNdshpJ5Las3vQ2DzQC5FGA&#43;BZ4YW4t5T/NTHA=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js" integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1&#43;ko&#43;UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
  
    
    
    
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.15ae6e2c9b1ac24a9ccf40003fa689efb1a18db1ee9b73d780b01a6c31b150441415862513e93184f68fe385759e4698b8763cba6a0f79493c1fed99ad5868d4.js" integrity="sha512-Fa5uLJsawkqcz0AAP6aJ77GhjbHum3PXgLAabDGxUEQUFYYlE&#43;kxhPaP44V1nkaYuHY8umoPeUk8H&#43;2ZrVho1A==" data-copy="Copier" data-copied="Copié"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Cyberdefenders · Digital Forensic · Szechuan Sauce" />
<meta property="og:description" content="The scenario:
Your bedroom door bursts open, shattering your pleasant dreams." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nathan-out.github.io/write-up/cyberdefenders-digital-forensics-szechuan-sauce/" /><meta property="article:section" content="write-up" />
<meta property="article:published_time" content="2023-10-26T12:40:36+02:00" />
<meta property="article:modified_time" content="2023-10-26T12:40:36+02:00" /><meta property="og:site_name" content="nathan.out" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cyberdefenders · Digital Forensic · Szechuan Sauce"/>
<meta name="twitter:description" content="The scenario:
Your bedroom door bursts open, shattering your pleasant dreams."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Write-up",
    "name": "Cyberdefenders · Digital Forensic · Szechuan Sauce",
    "headline": "Cyberdefenders · Digital Forensic · Szechuan Sauce",
    
    "abstract": "The scenario:\nYour bedroom door bursts open, shattering your pleasant dreams.",
    "inLanguage": "fr-fr",
    "url" : "https:\/\/nathan-out.github.io\/write-up\/cyberdefenders-digital-forensics-szechuan-sauce\/",
    "author" : {
      "@type": "Person",
      "name": "nathan.out"
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-10-26T12:40:36\u002b02:00",
    "datePublished": "2023-10-26T12:40:36\u002b02:00",
    
    "dateModified": "2023-10-26T12:40:36\u002b02:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "3165"
  }]
  </script>


  
  <meta name="author" content="nathan.out" />
  
    
      <link href="https://github.com/nathan-out" rel="me" />
    
  
  
  






  
  
  


  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Aller au contenu</a
      >
    </div>
    
    
      <header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <nav class="flex justify-between">
    
    <div>
      
        <a
          class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
          rel="me"
          href="/"
          >nathan.out</a
        >
      

    </div>
    
    
      <ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row">
        
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/posts/"
                title="Mes articles"
                >Articles</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/a-propos/"
                title="A Propos"
                >A propos</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/write-up/"
                title="Write-up"
                >Write-up</a
              >
            </li>
          
        
        
          <li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
            <button
              id="search-button"
              class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="Rechercher (/)"
            >
              

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
          </li>
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/write-up/"
      >Write-up</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/write-up/cyberdefenders-digital-forensics-szechuan-sauce/"
      >Cyberdefenders · Digital Forensic · Szechuan Sauce</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Cyberdefenders · Digital Forensic · Szechuan Sauce
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2023-10-26 12:40:36 &#43;0200 CEST">26 octobre 2023</time><span class="px-2 text-primary-500">&middot;</span><span title="Temps de lecture">15 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Sommaire
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#abstract">Abstract</a></li>
    <li><a href="#just-before-starting">Just before starting&hellip;</a></li>
    <li><a href="#q1-whats-the-operating-system-version-of-the-server-two-words">Q1 What’s the Operating System version of the Server? (two words)</a></li>
    <li><a href="#q2-whats-the-operating-system-of-the-desktop-four-words-separated-by-spaces">Q2 What’s the Operating System of the Desktop? (four words separated by spaces)</a></li>
    <li><a href="#q3-what-was-the-ip-address-assigned-to-the-domain-controller">Q3 What was the IP address assigned to the domain controller?</a></li>
    <li><a href="#q4-what-was-the-timezone-of-the-server">Q4 What was the timezone of the Server?</a></li>
    <li><a href="#q5-what-was-the-initial-entry-vector-how-did-they-get-in-provide-protocol-name">Q5 What was the initial entry vector (how did they get in)?. Provide protocol name.</a></li>
    <li><a href="#q6-what-was-the-malicious-process-used-by-the-malware-one-word">Q6 What was the malicious process used by the malware? (one word)</a></li>
    <li><a href="#q7-which-process-did-malware-migrate-to-after-the-initial-compromise-one-word">Q7 Which process did malware migrate to after the initial compromise? (one word)</a></li>
    <li><a href="#q8-identify-the-ip-address-that-delivered-the-payload">Q8 Identify the IP Address that delivered the payload.</a></li>
    <li><a href="#q9-what-ip-address-was-the-malware-calling-to">Q9 What IP Address was the malware calling to?</a></li>
    <li><a href="#q10-where-did-the-malware-reside-on-the-disk">Q10 Where did the malware reside on the disk?</a></li>
    <li><a href="#q11-whats-the-name-of-the-attack-tool-you-think-this-malware-belongs-to-one-word">Q11 What&rsquo;s the name of the attack tool you think this malware belongs to? (one word)</a></li>
    <li><a href="#q12-one-of-the-involved-malicious-ips-is-based-in-thailand-what-was-the-ip">Q12 One of the involved malicious IP&rsquo;s is based in Thailand. What was the IP?</a></li>
    <li><a href="#q13-another-malicious-ip-once-resolved-to-klient-293xyz--what-is-this-ip">Q13 Another malicious IP once resolved to klient-293.xyz . What is this IP?</a></li>
    <li><a href="#q14-the-attacker-performed-some-lateral-movements-and-accessed-another-system-in-the-environment-via-rdp-what-is-the-hostname-of-that-system">Q14 The attacker performed some lateral movements and accessed another system in the environment via RDP. What is the hostname of that system?</a></li>
    <li><a href="#q15-other-than-the-administrator-which-user-has-logged-into-the-desktop-machine-two-words">Q15 Other than the administrator, which user has logged into the Desktop machine? (two words)</a></li>
    <li><a href="#q16-what-was-the-password-for-jerrysmith-account">Q16 What was the password for &ldquo;jerrysmith&rdquo; account?</a></li>
    <li><a href="#q17-what-was-the-original-filename-for-beths-secrets">Q17 What was the original filename for Beth’s secrets?</a></li>
    <li><a href="#q18-what-was-the-content-of-beths-secret-file--six-words-spaces-in-between">Q18 What was the content of Beth’s secret file? ( six words, spaces in between)</a></li>
    <li><a href="#q19-the-malware-tried-to-obtain-persistence-in-a-similar-way-to-how-carbanak-malware-obtains-persistence-what-is-the-corresponding-mitre-technique-id">Q19 The malware tried to obtain persistence in a similar way to how Carbanak malware obtains persistence. What is the corresponding MITRE technique ID?</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>The scenario:</p>
<blockquote>
<p>Your bedroom door bursts open, shattering your pleasant dreams. Your mad scientist of a boss begins dragging you out of bed by the ankle. He simultaneously explains between belches that the FBI contacted him. They found his recently-developed Szechuan sauce recipe on the dark web. As you careen past the door frame you are able to grab your incident response “Go-Bag”. Inside is your trusty incident thumb drive and laptop. <strong>Some files may be corrupted just like in the real world. If one tool does not work for you, find another one.</strong></p>
</blockquote>
<h2 id="abstract" class="relative group">Abstract <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#abstract" aria-label="Ancre">#</a></span></h2>
<p>This article presents a unique challenge involving a scenario inspired by the television series &ldquo;Rick and Morty.&rdquo; In this challenge, a mad scientist boss drags you out of bed, claiming that the FBI contacted him about his stolen Szechuan sauce recipe found on the dark web. The challenge instructs you to use various tools to investigate multiple file types, each associated with specific tools. The questions presented in the challenge aim to uncover critical information about the compromise.</p>
<p>To summarize, the challenge delves into tasks like identifying the operating systems, discovering the initial entry vector, tracking the attacker&rsquo;s movement, and determining the attack tool employed. It offers a practical exercise for incident response professionals to hone their skills in a simulated cyber investigation environment.</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/rick.jpg" alt="Rick from Rick and Morty, this challenge is based on this sitcom." />
      
    </figure>
  

</p>
<figcaption>Rick from Rick and Morty, this challenge is a reference to this sitcom.</figcaption>
<hr>
<h2 id="just-before-starting" class="relative group">Just before starting&hellip; <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#just-before-starting" aria-label="Ancre">#</a></span></h2>
<p>This challenge contains <strong>many</strong> files. We have a lot of information and the challenge will not help you on which file you have to investigate on. You have to understand the differences between filetypes and tools associated.</p>
<p>Let&rsquo;s take a look to each of them:</p>
<ul>
<li><code>20200918_0417_DESKTOP-SDN1RPT.E01</code>, <code>E02</code>, <code>E03</code> and <code>E04</code></li>
</ul>
<p>Disk dump from a machine named <code>DESKTOP-SDN1RPT</code>. The reason why there are four files is because of the tool used (Encase), it cut the dump into four file for convenience, but you can consider as one file split into four.</p>
<ul>
<li><code>20200918_0417_DESKTOP-SDN1RPT.E01.txt</code></li>
</ul>
<p>It contains various information on <code>20200918_0417_DESKTOP-SDN1RPT.E01</code> such as the software used to acquire the dump (FTK Imager), file hash, evidence number and lot of technical stuff which is not interesting for us. By the way, this file is very usefull in real case.</p>
<ul>
<li><code>autoruns-desktop-sdn1rpt.csv</code></li>
</ul>
<p>CSV file which contains information about software configured to run when the machine is booted or a user log-in.</p>
<ul>
<li><code>autorunsc-citadel-dc01.csv</code></li>
</ul>
<p>Same as the previous one, but for the citadel machine.</p>
<ul>
<li><code>case001.pcap</code></li>
</ul>
<p>Network capture, contains information on network traffic.</p>
<ul>
<li><code>citadeldc01.mem</code></li>
</ul>
<p>RAM dump of the citadel machine, containing all runtime information.</p>
<ul>
<li><code>DESKTOP-SDN1RPT.mem</code></li>
</ul>
<p>Same as the previous one, but for the desktop machine.</p>
<ul>
<li><code>E01-DC01/</code>
<ul>
<li>
<p><code>20200918_0347_CDrive.E01</code>, <code>E02</code></p>
</li>
<li>
<p><code>20200918_0347_CDrive.E01.txt</code></p>
</li>
</ul>
</li>
</ul>
<p>Bellow a table summarizing tool and filetype associated:</p>
<table>
<thead>
<tr>
<th>Extension</th>
<th>Tool</th>
</tr>
</thead>
<tbody>
<tr>
<td>E0x</td>
<td>Autopsy, FTK Imager</td>
</tr>
<tr>
<td>mem</td>
<td>Volatility</td>
</tr>
<tr>
<td>pcap</td>
<td>Wireshark, Network Miner, Brim Security</td>
</tr>
<tr>
<td>csv, txt</td>
<td>Text editor, or an Excel like</td>
</tr>
</tbody>
</table>
<p>I will use Autopsy and not FTK Imager because Autopsy has a powerfull OS parser and FTK Imager is just to open and browse image file. Plus, I will not use Brim Security, as I&rsquo;m not familiar with, instead, I will use Wireshark and Network Miner.</p>
<h2 id="q1-whats-the-operating-system-version-of-the-server-two-words" class="relative group">Q1 What’s the Operating System version of the Server? (two words) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q1-whats-the-operating-system-version-of-the-server-two-words" aria-label="Ancre">#</a></span></h2>
<p>Using <a href="https://www.autopsy.com/">Autopsy</a>, create a new case and add data source (image file, add both <code>E01</code>) and waits until parsing is complete. Then, go to <code>Operating System Information</code>:</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/os_info.png" alt="The Program Name column contains the OS version." />
      
    </figure>
  

</p>
<figcaption>The Program Name column contains the OS version.</figcaption>
<p>To fully understand where this information is stored, you can also parse hives located at <code>C:\Windows\System32\config\SOFTWARE</code>, in the key <code>Microsoft\Windows NT\CurrentVersion</code>, Autopsy provides a native parser but you can also use <a href="https://www.sans.org/tools/registry-explorer/">Registry Explorer from Eric Zimmerman</a>.</p>
<h2 id="q2-whats-the-operating-system-of-the-desktop-four-words-separated-by-spaces" class="relative group">Q2 What’s the Operating System of the Desktop? (four words separated by spaces) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q2-whats-the-operating-system-of-the-desktop-four-words-separated-by-spaces" aria-label="Ancre">#</a></span></h2>
<p>Same as the previous one.</p>
<h2 id="q3-what-was-the-ip-address-assigned-to-the-domain-controller" class="relative group">Q3 What was the IP address assigned to the domain controller? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q3-what-was-the-ip-address-assigned-to-the-domain-controller" aria-label="Ancre">#</a></span></h2>
<p>As explained in the Q1, you can dump the <code>SYSTEM</code> hive located at: <code>C:\Windows\System32\config</code>. Or, use Network Miner, you have to convert <code>case001.pcap</code> into a format accepted by the software. To do that, just open the file with Wireshark &gt; Save As &gt; Choose <code>Wireshark/tcpdump... - pcap</code> and open it with Network Miner. Once opened, you will see an overview of the network:</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/network_miner1.png" alt="I love this tool, as it provides a very usefull overview, especially in this challenge where there are many machines." />
      
    </figure>
  

</p>
<figcaption>I love this tool, as it provides a very usefull overview, especially in this challenge where there are many machines.</figcaption>
<p>Search for a Citadel Windows machine and there is the IP.</p>
<h2 id="q4-what-was-the-timezone-of-the-server" class="relative group">Q4 What was the timezone of the Server? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q4-what-was-the-timezone-of-the-server" aria-label="Ancre">#</a></span></h2>
<p>Tricky question, first, you have to find the timezone set into the server. It&rsquo;s located into the <code>SYSTEM</code> registry. Using Autopsy, you can easily read it:</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/timezone.png" alt="" />
      
    </figure>
  

</p>
<p>The server is set on Pacific Standard Time which is UTC-7. <strong>But</strong> the admin set a wrong timezone on the domain controller. You can see it on NTP packets (clock unsynchronized). To retrieve the correct timezone, you can correlate two events in the network and in the DC. To see how you can do, you can check this write-up: <a href="https://ellisstannard.medium.com/cyberdefenders-szechuan-sauce-writeup-ab172eb7666c">https://ellisstannard.medium.com/cyberdefenders-szechuan-sauce-writeup-ab172eb7666c</a>.</p>
<p>You will see that the system is set one hour after the correct timezone.</p>
<h2 id="q5-what-was-the-initial-entry-vector-how-did-they-get-in-provide-protocol-name" class="relative group">Q5 What was the initial entry vector (how did they get in)?. Provide protocol name. <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q5-what-was-the-initial-entry-vector-how-did-they-get-in-provide-protocol-name" aria-label="Ancre">#</a></span></h2>
<p>Extract security logs from the DC located at: <code>%System32%\winevt\Logs\Security.evtx</code>. Then, you can use a log viewer such as Microsoft Event Viewer &gt; click on Open saved logs &gt; select your export.</p>
<p>Time to analyze, you can assume that the attacker wants to log into the machine. Each event has a given ID and the ID for failed attempt is <code>4625</code> and <code>4624</code> for a successfull one. To quickly have the list of the person who wants to access the machine, I used both <code>EvtxECmd</code> to dump all the logs (the Windows view did not satisfy me) and <code>EZViewer</code> to vizualize them. We can see that a Kali machine bruteforced the access with a successfull authentication on the DC using LogonType 10 which is RDP, we also have an IP.</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/bruteforce_kali.png" alt="" />
      
    </figure>
  

</p>
<p>Plus, we can investigate on the network dump. A good first step is to get an overview; Statistics &gt; Protocol Hierarchy.</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/protocol_hierarchy.png" alt="" />
      
    </figure>
  

</p>
<p>I highlighted RDP over UDP, this is interesting because RDP provides a graphical interface to connect to another computer over a network connection. Sometimes, RDP is used by attacker to gain access. To investigate more in depth, search on <code>rdp &amp;&amp; ip.dst == 10.42.85.10</code> (DC IP address). The first packet contains a Cookie filled with the value <code>nmap</code>, which is a scanning tool used by attackers. Plus, the source address is <code>194.61.24.102</code>, using VirusTotal you will see that this IP ws used by pirates.</p>
<h2 id="q6-what-was-the-malicious-process-used-by-the-malware-one-word" class="relative group">Q6 What was the malicious process used by the malware? (one word) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q6-what-was-the-malicious-process-used-by-the-malware-one-word" aria-label="Ancre">#</a></span></h2>
<p>Attacker gained access to the DC and we want to know what&rsquo;s happened on this machine, time to use Volatility! Usually, I start my investigation with <code>pstree</code> to get an overview:</p>
<pre tabindex="0"><code>PID     PPID    ImageFileName   Offset(V)       Threads Handles SessionId       Wow64   CreateTime      ExitTime

4       0       System  0xe00062c0a900  98      -       N/A     False   2020-09-19 01:22:38.000000      N/A
* 204   4       smss.exe        0xe00062c0a900  2       -       N/A     False   2020-09-19 01:22:38.000000      N/A
324     316     csrss.exe       0xe00062c0a900  8       -       0       False   2020-09-19 01:22:39.000000      N/A
404     316     wininit.exe     0xe00062c0a900  1       -       0       False   2020-09-19 01:22:40.000000      N/A
* 460   404     lsass.exe       0xe00062c0a900  31      -       0       False   2020-09-19 01:22:40.000000      N/A
* 452   404     services.exe    0xe00062c0a900  5       -       0       False   2020-09-19 01:22:40.000000      N/A
** 640  452     svchost.exe     0xe00062c0a900  8       -       0       False   2020-09-19 01:22:40.000000      N/A
*** 2056        640     WmiPrvSE.exe    0xe00062c0a900  11      -       0       False   2020-09-19 01:23:21.000000      N/A
*** 2764        640     WmiPrvSE.exe    0xe00062c0a900  6       -       0       False   2020-09-19 04:37:42.000000      N/A
** 1292 452     Microsoft.Acti  0xe00062c0a900  9       -       0       False   2020-09-19 01:22:57.000000      N/A
** 3724 452     spoolsv.exe     0xe00062c0a900  13      -       0       False   2020-09-19 03:29:40.000000      N/A
** 1556 452     VGAuthService.  0xe00062c0a900  2       -       0       False   2020-09-19 01:22:57.000000      N/A
** 796  452     vds.exe 0xe00062c0a900  11      -       0       False   2020-09-19 01:23:20.000000      N/A
** 668  452     svchost.exe     0xe00062c0a900  16      -       0       False   2020-09-19 01:22:41.000000      N/A
** 2460 452     msdtc.exe       0xe00062c0a900  9       -       0       False   2020-09-19 01:23:21.000000      N/A
** 800  452     svchost.exe     0xe00062c0a900  12      -       0       False   2020-09-19 01:22:40.000000      N/A
** 928  452     svchost.exe     0xe00062c0a900  16      -       0       False   2020-09-19 01:22:41.000000      N/A
** 1956 452     svchost.exe     0xe00062c0a900  30      -       0       False   2020-09-19 01:23:20.000000      N/A
** 2216 452     dllhost.exe     0xe00062c0a900  10      -       0       False   2020-09-19 01:23:21.000000      N/A
** 684  452     svchost.exe     0xe00062c0a900  6       -       0       False   2020-09-19 01:22:40.000000      N/A
** 1332 452     dfsrs.exe       0xe00062c0a900  16      -       0       False   2020-09-19 01:22:57.000000      N/A
** 1600 452     vmtoolsd.exe    0xe00062c0a900  9       -       0       False   2020-09-19 01:22:57.000000      N/A
** 848  452     svchost.exe     0xe00062c0a900  39      -       0       False   2020-09-19 01:22:41.000000      N/A
*** 3056        848     WMIADAP.exe     0xe00062c0a900  5       -       0       False   2020-09-19 04:37:42.000000      N/A
*** 3796        848     taskhostex.exe  0xe00062c0a900  7       -       1       False   2020-09-19 04:36:03.000000      N/A
** 1236 452     svchost.exe     0xe00062c0a900  8       -       0       False   2020-09-19 01:23:21.000000      N/A
** 1368 452     dns.exe 0xe00062c0a900  16      -       0       False   2020-09-19 01:22:57.000000      N/A
** 1000 452     svchost.exe     0xe00062c0a900  18      -       0       False   2020-09-19 01:22:41.000000      N/A
** 1644 452     wlms.exe        0xe00062c0a900  2       -       0       False   2020-09-19 01:22:57.000000      N/A
** 1392 452     ismserv.exe     0xe00062c0a900  6       -       0       False   2020-09-19 01:22:57.000000      N/A
** 1660 452     dfssvc.exe      0xe00062c0a900  11      -       0       False   2020-09-19 01:22:57.000000      N/A
412     396     csrss.exe       0xe00062c0a900  10      -       1       False   2020-09-19 01:22:40.000000      N/A
492     396     winlogon.exe    0xe00062c0a900  4       -       1       False   2020-09-19 01:22:40.000000      N/A
* 808   492     dwm.exe 0xe00062c0a900  7       -       1       False   2020-09-19 01:22:40.000000      N/A
3644    2244    coreupdater.ex  0xe00062c0a900  0       -       2       False   2020-09-19 03:56:37.000000      2020-09-19 03:56:52.000000
3472    3960    explorer.exe    0xe00062c0a900  39      -       1       False   2020-09-19 04:36:03.000000      N/A
* 2608  3472    vmtoolsd.exe    0xe00062c0a900  8       -       1       False   2020-09-19 04:36:14.000000      N/A
* 2840  3472    FTK Imager.exe  0xe00062c0a900  9       -       1       False   2020-09-19 04:37:04.000000      N/A
* 3260  3472    vm3dservice.ex  0xe00062c0a900  1       -       1       False   2020-09-19 04:36:14.000000      N/A
400     1904    ServerManager.  0xe00062c0a900  10      -       1       False   2020-09-19 04:36:03.000000      N/A
</code></pre><p>There is no obvious malicious file, but correlating <code>pstree</code> with <code>netscan</code> we will have a <strong>lot</strong> of results because it&rsquo;s a DC. Let&rsquo;s try to find a C2 evidence by highlighting the network traffic:</p>
<pre tabindex="0"><code>Offset	Proto	LocalAddr	LocalPort	ForeignAddr	ForeignPort	State	PID	Owner	Created

0x3148500	TCPv4	0.0.0.0	636	0.0.0.0	0	LISTENING	460	lsass.exe	-
0x314ac30	TCPv4	0.0.0.0	389	0.0.0.0	0	LISTENING	460	lsass.exe	-
0x314ac30	TCPv6	::	389	::	0	LISTENING	460	lsass.exe	-
0x31fa880	UDPv4	0.0.0.0	0	*	0		460	lsass.exe	2020-09-19 01:22:50.000000 
0x3f2b560	UDPv4	0.0.0.0	0	*	0		1368	dns.exe	2020-09-19 01:22:57.000000 
0x5ea7910	TCPv4	0.0.0.0	49152	0.0.0.0	0	LISTENING	404	wininit.exe	-
0x5ea7910	TCPv6	::	49152	::	0	LISTENING	404	wininit.exe	-
0x5eabed0	TCPv4	0.0.0.0	49152	0.0.0.0	0	LISTENING	404	wininit.exe	-
0x5eaf250	TCPv4	0.0.0.0	135	0.0.0.0	0	LISTENING	684	svchost.exe	-
0x5eb0540	TCPv4	0.0.0.0	135	0.0.0.0	0	LISTENING	684	svchost.exe	-
0x5eb0540	TCPv6	::	135	::	0	LISTENING	684	svchost.exe	-
0x5ee0b90	UDPv4	0.0.0.0	0	*	0		1368	dns.exe	2020-09-19 01:22:57.000000 
0x5ee9d20	UDPv4	0.0.0.0	0	*	0		1368	dns.exe	2020-09-19 01:22:57.000000 
0x5f25300	TCPv4	0.0.0.0	49153	0.0.0.0	0	LISTENING	800	svchost.exe	-
0x5f25300	TCPv6	::	49153	::	0	LISTENING	800	svchost.exe	-
0x5f284a0	TCPv4	0.0.0.0	49153	0.0.0.0	0	LISTENING	800	svchost.exe	-
0x5f9bec0	UDPv4	0.0.0.0	0	*	0		928	svchost.exe	2020-09-19 01:23:09.000000 
0x5f9bec0	UDPv6	::	0	*	0		928	svchost.exe	2020-09-19 01:23:09.000000 
0x5fa53b0	UDPv4	10.42.85.10	41136	*	0		4	System	2020-09-19 01:22:42.000000 
0x5fb76c0	UDPv4	10.42.85.10	41136	*	0		4	System	2020-09-19 01:22:42.000000 
0x5fd1880	TCPv4	0.0.0.0	49154	0.0.0.0	0	LISTENING	848	svchost.exe	-
0x5fd1880	TCPv6	::	49154	::	0	LISTENING	848	svchost.exe	-
0x5fdcdd0	TCPv4	0.0.0.0	49154	0.0.0.0	0	LISTENING	848	svchost.exe	-
...
0x20df6ba0	UDPv4	0.0.0.0	0	*	0		1368	dns.exe	2020-09-19 01:22:57.000000 
0x20e28d10	TCPv6	fe80::2dcf:e660:be73:d220	49155	fe80::2dcf:e660:be73:d220	62777	CLOSED	460	lsass.exe	-
0x20f52a00	TCPv6	fe80::2dcf:e660:be73:d220	135	fe80::2dcf:e660:be73:d220	62779	CLOSED	684	svchost.exe	N/A
0x20fc7590	TCPv4	10.42.85.10	62613	203.78.103.109	443	ESTABLISHED	3644	coreupdater.ex	N/A
0x20fffe50	TCPv4	0.0.0.0	62475	0.0.0.0	0	LISTENING	3724	spoolsv.exe	-
0x20fffe50	TCPv6	::	62475	::	0	LISTENING	3724	spoolsv.exe	-
0x211a9560	UDPv4	0.0.0.0	0	*	0		1368	dns.exe	2020-09-19 01:22:57.000000 
</code></pre><p>There is a suspicious process because it uses port number 443 and its IP is tagged as malicious by Virus Total. It&rsquo;s surrely our malware.</p>
<h2 id="q7-which-process-did-malware-migrate-to-after-the-initial-compromise-one-word" class="relative group">Q7 Which process did malware migrate to after the initial compromise? (one word) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q7-which-process-did-malware-migrate-to-after-the-initial-compromise-one-word" aria-label="Ancre">#</a></span></h2>
<p>A <strong>very usefull</strong> Volatility plugin is <code>malfind</code>, it helps to identify injected code inside process. A Windows executable always start with <code>MZ</code>. Finding a <code>MZ</code> header inside a process is very suspicious because is a strong sign of code injection.</p>
<pre tabindex="0"><code>3724    spoolsv.exe     0x4afc1f0000    0x4afc25afff    VadS    PAGE_EXECUTE_READWRITE  107     1       Disabled
4d 5a 90 00 03 00 00 00 MZ......
04 00 00 00 ff ff 00 00 ........
b8 00 00 00 00 00 00 00 ........
40 00 00 00 00 00 00 00 @.......
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 01 00 00 ........
0x4afc1f0000:   pop     r10
0x4afc1f0002:   nop
0x4afc1f0003:   add     byte ptr [rbx], al
0x4afc1f0005:   add     byte ptr [rax], al
0x4afc1f0007:   add     byte ptr [rax + rax], al
0x4afc1f000a:   add     byte ptr [rax], al
3724    spoolsv.exe     0x4afc070000    0x4afc0a8fff    VadS    PAGE_EXECUTE_READWRITE  57      1       Disabled
4d 5a 41 52 55 48 89 e5 MZARUH..
48 83 ec 20 48 83 e4 f0 H...H...
e8 00 00 00 00 5b 48 81 .....[H.
c3 b7 57 00 00 ff d3 48 ..W....H
81 c3 34 b6 02 00 48 89 ..4...H.
3b 49 89 d8 6a 04 5a ff ;I..j.Z.
d0 00 00 00 00 00 00 00 ........
00 00 00 00 f0 00 00 00 ........
0x4afc070000:   pop     r10
0x4afc070002:   push    r10
0x4afc070004:   push    rbp
0x4afc070005:   mov     rbp, rsp
0x4afc070008:   sub     rsp, 0x20
0x4afc07000c:   and     rsp, 0xfffffffffffffff0
0x4afc070010:   call    0x4afc070015
0x4afc070015:   pop     rbx
0x4afc070016:   add     rbx, 0x57b7
0x4afc07001d:   call    rbx
0x4afc07001f:   add     rbx, 0x2b634
0x4afc070026:   mov     qword ptr [rbx], rdi
0x4afc070029:   mov     r8, rbx
0x4afc07002c:   push    4
0x4afc07002e:   pop     rdx
0x4afc07002f:   call    rax
0x4afc070031:   add     byte ptr [rax], al
0x4afc070033:   add     byte ptr [rax], al
0x4afc070035:   add     byte ptr [rax], al
0x4afc070037:   add     byte ptr [rax], al
0x4afc070039:   add     byte ptr [rax], al
0x4afc07003b:   add     al, dh
0x4afc07003d:   add     byte ptr [rax], al
3724    spoolsv.exe     0x4afc260000    0x4afc283fff    VadS    PAGE_EXECUTE_READWRITE  36      1       Disabled
4d 5a 90 00 03 00 00 00 MZ......
04 00 00 00 ff ff 00 00 ........
b8 00 00 00 00 00 00 00 ........
40 00 00 00 00 00 00 00 @.......
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 00 00 00 ........
00 00 00 00 e0 00 00 00 ........
0x4afc260000:   pop     r10
0x4afc260002:   nop
0x4afc260003:   add     byte ptr [rbx], al
0x4afc260005:   add     byte ptr [rax], al
0x4afc260007:   add     byte ptr [rax + rax], al
0x4afc26000a:   add     byte ptr [rax], al
</code></pre><h2 id="q8-identify-the-ip-address-that-delivered-the-payload" class="relative group">Q8 Identify the IP Address that delivered the payload. <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q8-identify-the-ip-address-that-delivered-the-payload" aria-label="Ancre">#</a></span></h2>
<p>Refer to Q5 answer. Using this Wireshark filter : <code>rdp &amp;&amp; ip.dst == 10.42.85.10</code> we can see that the source IP is always <code>194.61.24.102</code>. Plus, VirusTotal flag this IP as potentially malicious. Using Network Miner, there is another clue, this machine uses <code>nmap</code>:</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/nmap_clue.png" alt="" />
      
    </figure>
  

</p>
<h2 id="q9-what-ip-address-was-the-malware-calling-to" class="relative group">Q9 What IP Address was the malware calling to? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q9-what-ip-address-was-the-malware-calling-to" aria-label="Ancre">#</a></span></h2>
<p>Since Q6, we already know the C2 address; this is the address the malware communicate with.</p>
<h2 id="q10-where-did-the-malware-reside-on-the-disk" class="relative group">Q10 Where did the malware reside on the disk? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q10-where-did-the-malware-reside-on-the-disk" aria-label="Ancre">#</a></span></h2>
<p>We are looking for disk evidence, let&rsquo;s use Autopsy again. To search for a filename, go to Tools &gt; File Search by Attributes:</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/autopsy_search.png" alt="" />
      
    </figure>
  

</p>
<p>Here are the results:</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/szechuan-sauce/coreupdater_location.png" alt="" />
      
    </figure>
  

</p>
<h2 id="q11-whats-the-name-of-the-attack-tool-you-think-this-malware-belongs-to-one-word" class="relative group">Q11 What&rsquo;s the name of the attack tool you think this malware belongs to? (one word) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q11-whats-the-name-of-the-attack-tool-you-think-this-malware-belongs-to-one-word" aria-label="Ancre">#</a></span></h2>
<p>Extract <code>coreupdater.exe</code>, calculate its footprint and go to VirusTotal, you will find that this program is built on a famous offensive framework. I suppose that is you try to reverse it, you will find the tool name too.</p>
<h2 id="q12-one-of-the-involved-malicious-ips-is-based-in-thailand-what-was-the-ip" class="relative group">Q12 One of the involved malicious IP&rsquo;s is based in Thailand. What was the IP? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q12-one-of-the-involved-malicious-ips-is-based-in-thailand-what-was-the-ip" aria-label="Ancre">#</a></span></h2>
<p>Use an online tool like <a href="https://www.hostip.fr/">https://www.hostip.fr/</a> to locate one of the previous two IP address.</p>
<h2 id="q13-another-malicious-ip-once-resolved-to-klient-293xyz--what-is-this-ip" class="relative group">Q13 Another malicious IP once resolved to klient-293.xyz . What is this IP? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q13-another-malicious-ip-once-resolved-to-klient-293xyz--what-is-this-ip" aria-label="Ancre">#</a></span></h2>
<p>I didn&rsquo;t understood the question and its sens. I tried to search on this hostname on the network dump. One of the intended answer was to use Virus Total and retrieve one of the previous involved IP.</p>
<h2 id="q14-the-attacker-performed-some-lateral-movements-and-accessed-another-system-in-the-environment-via-rdp-what-is-the-hostname-of-that-system" class="relative group">Q14 The attacker performed some lateral movements and accessed another system in the environment via RDP. What is the hostname of that system? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q14-the-attacker-performed-some-lateral-movements-and-accessed-another-system-in-the-environment-via-rdp-what-is-the-hostname-of-that-system" aria-label="Ancre">#</a></span></h2>
<p>We have two disk and RAM dumps, we can assume that the second system is <code>Desktop-SDN1RPT</code>, but let&rsquo;s prove it. Thanks to Wireshark, we can get all the outgoing RDP connexion from the DC: <code>rdp &amp;&amp; ip.src == 10.42.85.10</code>. You can see packets from the DC to the attacker&rsquo;s host but also to <code>10.42.85.115</code>, thanks to Network Miner, you can find the hostname. If you don&rsquo;t have Network Miner, you can resolve the hostname by searching <code>LLMNR</code> packets in Wireshark.</p>
<h2 id="q15-other-than-the-administrator-which-user-has-logged-into-the-desktop-machine-two-words" class="relative group">Q15 Other than the administrator, which user has logged into the Desktop machine? (two words) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q15-other-than-the-administrator-which-user-has-logged-into-the-desktop-machine-two-words" aria-label="Ancre">#</a></span></h2>
<p>You can browse logs but when a user login for the first time, a new user is created on the host machine. Go to <code>C:\Users</code> to see all of them. I don&rsquo;t know which one is the intended, just try both.</p>
<h2 id="q16-what-was-the-password-for-jerrysmith-account" class="relative group">Q16 What was the password for &ldquo;jerrysmith&rdquo; account? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q16-what-was-the-password-for-jerrysmith-account" aria-label="Ancre">#</a></span></h2>
<p>Quite tricky question, and not a forensic one. You can resolve it by extract hashes from the DC disk dump and crack them. To extract it, use <code>secretsdump.py</code> or <code>ntdsutils.exe</code> (available in a DC), the first method is the easiest one. First, you need to extract files which contains hashes:</p>
<ul>
<li>
<p><code>C:\Windows\System32\config\SYSTEM</code></p>
</li>
<li>
<p><code>C:\Windows\NTDS\ntds.dit</code></p>
</li>
</ul>
<p>Then, use the Python tool to extract hashes and finally crack them with John, Hashcat on an online tool (weak password). To extract hashes with <code>secretsdump.py</code>:</p>
<p><code>python secretsdump.py -system &lt;SYSTEM hive path&gt; -ntds &lt;ntds.dit path&gt; -outputfile &lt;path&gt;</code></p>
<h2 id="q17-what-was-the-original-filename-for-beths-secrets" class="relative group">Q17 What was the original filename for Beth’s secrets? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q17-what-was-the-original-filename-for-beths-secrets" aria-label="Ancre">#</a></span></h2>
<p>We can suppose that this file has a name like <code>.*secret.*</code> or <code>.*beth.*</code>, we can search a file by its filename with Autopsy (Tools &gt; File Search by Attributes), we will find several files related to a txt file. Plus, Autopsy can read it and give its content.</p>
<h2 id="q18-what-was-the-content-of-beths-secret-file--six-words-spaces-in-between" class="relative group">Q18 What was the content of Beth’s secret file? ( six words, spaces in between) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q18-what-was-the-content-of-beths-secret-file--six-words-spaces-in-between" aria-label="Ancre">#</a></span></h2>
<p>Unfortunately, this isn&rsquo;t the correct answer. We can see that the file was deleted (red cross), maybe the file is still in the bin? Go to <code>$Recycle.Bin</code>, there is a folder named like <code>S-1-...-500</code>, 500 is the Administrator&rsquo;s ID, so this folder contains Administrator&rsquo;s deleted files. Inside it, filenames are broken (if you know how filesystem works you already know that is intended), just open each of them, you will find the answer. The very first one contains printable caracters: <code>FileShare\Secrets\SECRET_beth.txt</code> and the second one contains its content.</p>
<h2 id="q19-the-malware-tried-to-obtain-persistence-in-a-similar-way-to-how-carbanak-malware-obtains-persistence-what-is-the-corresponding-mitre-technique-id" class="relative group">Q19 The malware tried to obtain persistence in a similar way to how Carbanak malware obtains persistence. What is the corresponding MITRE technique ID? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q19-the-malware-tried-to-obtain-persistence-in-a-similar-way-to-how-carbanak-malware-obtains-persistence-what-is-the-corresponding-mitre-technique-id" aria-label="Ancre">#</a></span></h2>
<p>Tricky question, as you juste have to do some threat hunting; search informations on Cabarnak malware and its persitence method. You will find this website: <a href="https://attack.mitre.org/groups/G0008/">https://attack.mitre.org/groups/G0008/</a>, search for persistence and its Mitre ID.</p>

      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="nathan.out"
          src="/img/author_hu00bba01d950a59fc7877b060fc60a3bd_21567_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Auteur
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          nathan.out
        </div>
      
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/nathan-out"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/write-up/cyberdefenders-acoustic/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Cyberdefenders · Digital Forensic · Acoustic</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-09-03 22:08:20 &#43;0200 CEST">3 septembre 2023</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/write-up/nbctf2023-cryptotraque/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >NoBracketsCTF 2023 Write-Up Cryptotraque 1, 2 et 5</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-11-20 21:55:22 &#43;0100 CET">20 novembre 2023</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div
            class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Faire défiler jusqu&#39;au bas de la page"
              title="Faire défiler jusqu&#39;au bas de la page"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2023
            nathan.out
        </p>
      
      
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Passer au thème sombre"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible"
  data-url="https://nathan-out.github.io/"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2"
          placeholder="Rechercher"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
        title="Fermer (Esc)"
      >
        

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
